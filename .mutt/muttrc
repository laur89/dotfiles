# vim: syntax=neomuttrc
# 
# ref: http://durak.org/sean/pubs/software/mutt/reference.html
# see https://wiki.archlinux.org/title/Mutt
#   - note https://wiki.archlinux.org/title/Mutt#Tips_and_tricks lists good tuts!
#
# see also http://www.davep.org/mutt/muttrc/
# more noteworthy dotfiles for mutt:
# - https://github.com/cyphar/dotfiles/blob/main/.mutt/muttrc
# - https://github.com/tshirtman/.mutt/tree/master
#
# + some tips/shortcuts/keybinds:
# - limit/filter shown emails by l key; to view all again/reset, use "all" keyword
#   ~F for flagged messages; ~U for unread
# - o to change sorting in index
#
# main opts:
  set ask_cc  # prompt for carbon-copy (Cc) recipients before editing the body of an outgoing message.
unset confirmappend  # don't ask
  set delete  # don't ask for deletion confirmation
  set quit    # dont ask
  unset move  # gmail and xchange does that
  set alias_file = '~/.mutt/alias'  # default file in which to save aliases created by the <create-alias> function.
                                    # note this will be unused if using abook, goobook et.al
  set edit_headers  # make the headers editable
  auto_view text/html text/calendar  # automatically open these mimetypes per programs in mailcap
  set editor            = "nvim +/^$"  # skip to 1st blank line
  set send_charset="us-ascii:utf-8"  # A colon-delimited list of character sets for outgoing messages
  set fast_reply  # skip to compose when replying, instead of being prompted who to reply to
  set include     # include msg in replies, instead of being prompted whether we want to include original mail
  set folder            = ~/mail  # mail in here; do not end with slash!
  set forward_quote  # include msg in forwards
  set quote_regex = "^( {0,4}[>|:#%]| {0,4}[a-z0-9]+[>|]+)+"
  # if you have more than a few emails, you *really* want this
  set header_cache = ~/.mutt/caches  # where to store message headers locally to speed things up; point to a directory
  set message_cache_dir = ~/.mutt/caches  # where to store bodies; point to a directory; can be same folder as header_cache
                                          # think only used with built-in IMAP support
  set certificate_file = '~/.mutt/.mutt_certificates'  # file where the certificates you trust are saved. dunno.
unset help
  set mailcap_path      = ~/.mutt/mailcap  # see also auto_view config to auto-view some types in pager
unset mark_old   # read/new is ok enough
#set beep_new  # bell on new mail
unset markers  # no ugly plus signs; if set, a "+" marker is displayed at the beginning of wrapped lines
  set mbox_type         = Maildir  # default mailbox type used when creating new folders.
  set menu_scroll  # scroll in menus
  set pager_context     = 5  # retain 5 lines of previous page when scrolling
  set pager_index_lines = 10  # nr of index lines to show in pager view
  set pager_stop  # don't go to next message/mail automatically
  set smart_wrap  # don't split words
  set pipe_decode   # strip headers and eval mimes when piping
  set forward_decode  # decode when fwding
  set check_new = yes
  set realname          = "Laur Aliste"  # !! possibly re-defined by per-account config!
  set abort_nosubject = yes
  set recall=no  # do not offer to recall a postponed msg when you start composig new one
  set text_flowed=yes  # flow the lines of quoted text in outher mailclients,
                       # instead of producing ugly linebreaks (read http://joeclark.org/ffaq.html)
  #set print_command="/usr/bin/muttprint %s -p {PrinterName}"  # for printing, install muttprint pkg, and uncomment

# this block from https://github.com/smemsh/.mutt/
# Postfix uses the envelope sender to determine which from
# `sasl_auth_map' to use.  We have to use the correct login
# because if it's different than the body's internal `from'
# address, Gmail rewrites return-path to be the canonical
# login account, which causes a mismatch and we get flagged
# as spam at a lot of places.  Mutt will set the envelope
# sender if told to, and if the address isn't specified, it
# will be taken from the `from' header internal to the
# message.  Note that the problem now becomes how to track
# sent mail items from the account they didn't go through,
# because these are not forwarded; only incoming mail is.
#
set use_envelope_from
set envelope_from_address


set wait_key=no  # Don't show the "Press any key to continue..." message.

## built-in IMAP:
#set imap_login = 'your.username'  # This variable defaults to the value of $imap_user; note gmail requires full email
#set imap_pass = 'imap.pass'
#set folder=imap[s]://imap.server.domain[:port]/[folder/]   # e.g. imaps://imap.gmail.com/; for several accounts it's best to use imaps://username@imap.gmail.com/
#set imap_check_subscribed  # check for all subscribed IMAP folders (as if all were added with a mailboxes line)
set mail_check = 120  # interval to check new mail (in sec); unsure whether it's only relevant to imap or not

  set sleep_time=0  # open dirs w/o delay
  set sendmail_wait = -1  # dont wait for sending (i.e. $sendmail process) to complete
  set fcc_attach  # save attachments of the outgoing mail with the body
  unset mime_forward  # fwd attachments as part of body
  set forward_format    = "Fwd: %s"
  set ispell = "aspell -e -c"
  set attribution =  "On %d, %n wrote:"  # set the attribution
  #set attribution = "%F on %{%Y/%m/%d %Z @%H:%M:%S}:"

  #set record = +Sent
unset record  # where all your sent e-mails will be saved; gmail automatically saves 'em into +[Gmail]/Sent, so we do not want dupes

  set reply_to  # reply to Reply to: field
  set reverse_name  # reply to whomever it was to
  #set alias_sort       = alias  # specifies which field to use to sort the alias list when displayed in Mutt. Possible values: alias, address
                                 # best leave undefined if setting $query_command
unset imap_passive  # Allow Mutt to open new imap connection automatically.
set imap_keepalive = 300  # Keep IMAP connection alive by polling intermittently (time in seconds).

# When set, specifies a command used to filter messages.  When a message is viewed it
# is passed as standard input to $display_filter, and the filtered message is read from the standard output:
set display_filter = '~/dev/scripts/mutt/display_filter_entry.sh'

# sidebar:
    set mail_check_stats=yes
    set sidebar_visible=yes
    set sidebar_width   = 25
    set sidebar_format="%B%*  %S%?N?(%N)?%?F?[%F]?"
    set sidebar_indent_string=" "
    #set sidebar_component_depth=1  # Shorten mailbox names (truncate 1 subdirs)
    #set sidebar_delim_chars="/"  # Delete everything up to the last or nth / character
  # and optionally:
    set sidebar_folder_indent=yes
    set sidebar_short_path=yes  # shorten mailbox names
    set sidebar_non_empty_mailbox_only=yes   # sidebar will only display mailboxes that contain one or more mails;
                                             # note it'll filter out also empty virtual mailboxes
    #set sidebar_sort = unread  # default is unsorted
  color sidebar_new yellow default   # mailboxes containing new mail
  #color sidebar_indicator default color17
  #color sidebar_new color221 color233
  #set sidebar_divider_char = '|'


#set reverse_alias  # show names from alias file in index
unset sig_dashes  # If set, a line containing "-- " (note the trailing space) will be inserted before your $signature
  set signature         = ~/.mutt/signature
  set sig_on_top = yes  # signature BEFORE quoted text
  #sorting:
  #
  # fyi:  When $use_threads is "threads" or "reverse", $sort controls the sorting
  #       between threads, and $sort_aux controls the sorting within a thread.
  set use_threads=threads  # note this is newer config item and conflicts w/ "sort" if sort=threads
  set sort              = reverse-last-date-received  # like gmail
  set sort_aux          = reverse-last-date-received  # like gmail
  #
  set uncollapse_jump  # jump to the next unread message, if any, when the current thread is un collapsed

  # spoolfile is the folder where (unfiltered) email arrives; most services
  # conventionally name it INBOX; you can use = or + as a substitution for the
  # configured 'folder' path, e.g. set spoolfile=+INBOX
  # note our spool_file is currently set by detect-mailboxes.sh!
  #set spool_file         = "+work/Inbox"  # work is default inbox; so-called startup folder
  set sort_re  # thread based on regex
  set reply_regex = "^(([Rr][Ee]?(\[[0-9]+\])?: *)?(\[[^]]+\] *)?)*"

  # status bar:
  #set status_on_top  # status bar on top
  set status_chars = " *%A"  # Controls the characters used by the "%r" indicator in $status_format; rtfm
  #set status_format     = "-%r- %f%?t? Tagged:%t?%?p? Drafts:%p? -%>-"
  set status_format = "â”€â”€â”€[ Folder: %f ]â”€â”€â”€[%r%m messages%?n? (%n new)?%?d? (%d to delete)?%?t? (%t tagged)? ]â”€â”€â”€%>â”€%?p?( %p postponed )?â”€â”€â”€"

  index-format-hook  date  "~d<1d"    "%[%H:%M]"
  index-format-hook  date  "~d<1w"    "%[%a %H:%m]"
  index-format-hook  date  "~d<1m"    "%[%a %d]"    # Thu 17
  index-format-hook  date  "~d<1y"    "%[%b %d]"    # Jul 17
  index-format-hook  date  "~A"       "%[%m/%y]"    # 07/25

  #set index_format = "%3C [%Z] %?X?A&-? %D %-15.15F %s"  # note the '%?X?A&-?' displays 'A' or '-' depending on presence of an attachment
  #set index_format = '/home/laur/bin/mutt-index-format "%9[%d.%m.%y]" "%9[%e.%b]" "%8[%a %H:%m]" "%[%H:%m]" "%3C [%Z] %?X?%2X& -? %%s %-20.20L %?M?+%-2M&   ? %s %> [%4c]asladfg" "%[%s]" |'
  #set index_format="%4C %-6@date@ %-15.15F %Z (%4c) %s"
  set index_format="%4C %-6@date@ %-15.15F %Z (%4c) %@iconflag@ %?GR?%GR&ã€€? %?GA?%GA&ã€€? %?GD?%GD&%GC? %s"

  # Replace some tags with icons {{{  # from https://www.reddit.com/r/neomutt/comments/nk3xs5/interesting_examples_of_index_format_how_to/
  # tag-transforms tag transformed-string
  tag-transforms "inbox"   "ðŸ“©"   \
                 "unread"  "âœ‰"   \
                 "replied" "ðŸ–†"  \
                 "sent"    "ðŸ“¤"  \
                 "todo"    "T"   \
                 "deleted" "ðŸ—‘" \
                 "invite"  "ðŸ“…" \
                 "attachment" "ðŸ—Ž"

  # The formats must start with 'G' and the entire sequence is case sensitive.
  # tag-formats tag format-string { tag format-string ...}
  tag-formats "inbox"   "GI" \
              "unread"  "GU" \
              "replied" "GR" \
              "sent"    "GS" \
              "todo"    "Gt" \
              "deleted" "GD" \
              "invite"  "GC" \
              "attachment" "GA"

  # index-format-hook is used to inject format strings dynamically into $index_format
  # based on pattern matching against the current message:
  index-format-hook  iconflag  "~P"    "ðŸ“¤"
  index-format-hook  iconflag  "~U"    "ðŸ“«"
  index-format-hook  iconflag  "~R"    "âœ‰"
  #set index_format='%4C|%<[y?%<[m?%<[d?%[     %H:%M]&%[    %a %d]>&%[    %b %d]>&%[%d/%m/%Y]>| %-25.25F%< M?(%3M)&      > %@iconflag@ %?GR?%GR&ã€€? %?GA?%GA&ã€€? %?GD?%GD&%GC?  %s'
  # }}}

  set alias_format = "%4n %t %-20a %r"
#color status red default  # colors come from included file

  set auto_tag = yes  # apply commands to all tagged messages by default
  set strict_threads
  set thorough_search  # the headers and body/attachments of messages to be searched are decoded before searching
  set tilde  # the internal-pager will pad blank lines to the bottom of the screen with a tilde
  set timeout           = 3  # When NeoMutt is waiting for user input either idling in menus or in an interactive prompt, NeoMutt would block until input is present
  set tmp_dir            = ~/.mutt/temp
  set mask=""  # show all files/directories in the browser (eg dotfiles included)

# alternates is used to inform NeoMutt about alternate addresses where you receive mail;
# This affects NeoMutt's idea about messages from you, and messages addressed to you.
# e.g. per https://wiki.archlinux.org/title/Mutt#Ignore_own_e-mail_addresses_from_group-reply,
# this allows to skip replying to our own mail when group-replying to a mail we were cc'ed:
#alternates .*@pbrisbin\.com .*@brisb\.in

# defines an order of preference that is used by NeoMutt to determine which part of a multipart/alternative body to display:
alternative_order text/calendar text/plain text/enriched text/html text/* text  # order matters

ignore *  # ignore all hdrs
unignore from: to: cc: date: subject:  # show only these
unhdr_order *                          # some distros order things by default, clear their rules first
hdr_order from: to: cc: date: subject:

# NeoMutt notmuch config:
# -------------------------------------
#set nm_default_uri="notmuch:///~/mail" # path to the maildir; defaults to $folder

# When set, mutt will use the first virtual mailbox (see virtual-mailboxes) as a spoolfile;
# as of '25 this command is unnecessary. $spool_file has been extended to support
# mailbox descriptions as a value.
#set virtual_spool_file=yes

# note you might have issues because your own replies are missing from threads; in
# that case, start using virtual boxes: https://www.reddit.com/r/commandline/comments/53dh17/mutt_getting_thread_replies_in_inbox/

# note from arch wiki: "You must set the mailboxes variables or the imap_check_subscribed to tell the sidebar which folder should be displayed"
source ~/.mailboxes        # source virtual boxes; (if not listed in sidebar, then look up macro for 'change-vfolder')

# This variable allows you to customize the file browser display
#set folder_format = "%6n(%6N) %f"
#unvirtual-mailboxes *


# -------------------------------------

# per manual:
# > The subscribe command adds a mailing list to the lists of known and subscribed
#   mailing lists. The unsubscribe command removes it from the list of subscribed mailing lists.
# Still unsure what's it about lol.
#subscribe arch-announce arch-dev-public arch-haskell aur-general \
          #rubyparley vim web-devel xmonad yesod

# set colors:
# see https://github.com/tomauty/dotfiles/tree/master/mutt/.mutt/colors
# ##########################################
#source ~/.mutt/colors/colors_first
#source ~/.mutt/colors/base16-solarized
#source ~/.mutt/colors/base16-solarized-dark
#source ~/.mutt/colors/base16
#source ~/.mutt/colors/vombat
source ~/.mutt/colors/gruvbox
#source ~/.mutt/colors/gruvbox_2
#source ~/.mutt/colors/gruvbox_2_extended


source ~/.mutt/bindings
source ~/.mutt/macros
#source ~/.mutt/gpg
source ~/.mutt/hooks
source $alias_file


#source ~/.mutt/mailboxes.all  # watch these mailboxes for new mail
source '~/.mutt/scripts/detect-mailboxes.sh|'  # watch these mailboxes for new mail; note this defines/sources the 'mailboxes' config!

