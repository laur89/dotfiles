# vim: syntax=neomuttrc
macro index ,i      "<change-folder>!<enter>"  "go to inbox"
#macro index ,p      "<pipe-message>cat > ~/"   "save message as"
#macro index <space> "<collapse-thread>"        "[un]collapse thread"  # already set in bindings!

#macro index ,u "\
  #<enter-command>set \
    #my_old_pipe_decode=\$pipe_decode \
    #nopipe_decode \
  #<enter>\
  #<pipe-message>ghu<enter>\
  #<delete-thread>\
  #<enter-command>set \
    #pipe_decode=\$my_old_pipe_decode \
  #<enter>" \
  #"Unsubscribe from any email with a List-Unsubscribe header"

# Ctrl-R to mark all as read:
#macro index \Cr "T~U<enter><tag-prefix><clear-flag>N<untag-pattern>.<enter>" "mark all messages as read"
macro index <esc>m "T~N<enter>;WNT~O<enter>;WO\CT~T<enter>" "mark all messages read"
macro index \Cr "<tag-prefix><clear-flag>N" "mark tagged messages as read"

# open urls: {{{
#macro index,pager \cb "<pipe-message> urlview<Enter>" "call urlview to extract URLs out of a message"
#macro attach,compose \cb "<pipe-entry> urlview<Enter>" "call urlview to extract URLs out of a message"

# urlscan is an alternative to urlview:  https://github.com/firecat53/urlscan
macro index,pager \cb "<pipe-message> urlscan<Enter>" "call urlscan to extract URLs out of a message"
macro attach,compose \cb "<pipe-entry> urlscan<Enter>" "call urlscan to extract URLs out of a message"
# }}} /open urls

#macro attach 'V' "<pipe-entry>cat >~/.cache/mutt/mail.html && $BROWSER ~/.cache/mutt/mail.html && rm ~/.cache/mutt/mail.html<enter>" "open mail in graphical browser"
# note following macro requires setting intl.charset.fallback.utf8_for_file = true in about:config if $BROWSER=firefox, per https://wiki.archlinux.org/title/Mutt#Viewing_HTML :
macro attach 'V' "<pipe-entry>iconv -c --to-code=UTF8 > ~/.cache/mutt/mail.html<enter><shell-escape>$BROWSER ~/.cache/mutt/mail.html<enter>" "open mail in graphical browser"

# note we now have sidebar toggle in bindings instead:
#macro index b '<enter-command>toggle sidebar_visible<enter><refresh>'
#macro pager b '<enter-command>toggle sidebar_visible<enter><redraw-screen>'

macro pager     i       ":set pager_index_lines=10\r"  # restore incex split with X lines
macro pager     I       ":set pager_index_lines=0\r"   # hide index split
macro pager     U       |urlscan\r

#macro pager     M       ":toggle markers\r"
#macro pager     z       ":set wrap=0\r"
#macro pager Z ":set wrap=80\r"

# archive Gmail mail: (from https://wiki.archlinux.org/title/Mutt#Archive_treated_e-mails)
macro index \' "<tag-pattern>~R !~D !~F<enter><tag-prefix><save-message>+[Gmail]/All <enter>" "Archive"
#macro index A "<modify-labels>+archive -unread -inbox\\n" "Archive message"  # archive using notmuch tags
macro index c "<change-vfolder>?" "Change to vfolder overview"
#bind index,pager c change-vfolder
#macro index c '<change-folder>?<change-dir><home>^K=<enter>'  # TODO: this seems broken

# generate virtual folder from query (note we also have similar function in bindings):
macro index \\\\ "<vfolder-from-query>" "Search mailbox"

# attach & save attachments using external program; from https://github.com/anufrievroman/neomutt-file-picker {{{
# type A instead of standard a to call the script that opens vifm:
macro compose A "<shell-escape>bash $HOME/.mutt/scripts/filepicker<enter><enter-command>source /tmp/.mutt-file-picker.tmp<enter><shell-escape>bash $HOME/.mutt/scripts/filepicker clean<enter>" "Attach with your file manager"
# on the attachment _saving_ screen (by default reached w/ 'v'), type S instead of standard s to
# call the script - vifm is opened; choose folder & quit:
macro attach S "<shell-escape>bash $HOME/.mutt/scripts/dirpicker<enter><enter-command>source /tmp/.mutt-file-picker.tmp<enter>y<enter>" "Choose folder with ranger"
# }}} /attachments
